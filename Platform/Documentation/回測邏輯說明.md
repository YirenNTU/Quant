# ğŸ“Š å›æ¸¬é‚è¼¯èªªæ˜

æœ¬æ–‡æª”è©³ç´°èªªæ˜ Investment AI Platform çš„å›æ¸¬é‚è¼¯ï¼ŒåŒ…æ‹¬èª¿å€‰é »ç‡ã€æ›è‚¡æ©Ÿåˆ¶ç­‰æ ¸å¿ƒæµç¨‹ã€‚

---

## ğŸ”„ èª¿å€‰é »ç‡ (Rebalance Frequency)

### æ”¯æ´çš„é »ç‡é¸é …

å›æ¸¬å¼•æ“æ”¯æ´ä¸‰ç¨®èª¿å€‰é »ç‡ï¼Œé€é `rebalance_freq` åƒæ•¸è¨­å®šï¼š

| é »ç‡ | åƒæ•¸å€¼ | èªªæ˜ | èª¿å€‰æ—¥ |
|------|--------|------|--------|
| **æ¯æ—¥** | `"daily"` | æ¯å€‹äº¤æ˜“æ—¥éƒ½èª¿å€‰ | æ‰€æœ‰äº¤æ˜“æ—¥ |
| **æ¯é€±** | `"weekly"` | æ¯é€±èª¿å€‰ä¸€æ¬¡ | **æ¯é€±äº”** (dayofweek == 4) |
| **æ¯æœˆ** | `"monthly"` | æ¯æœˆèª¿å€‰ä¸€æ¬¡ | **æ¯æœˆæœ€å¾Œä¸€å€‹äº¤æ˜“æ—¥** |

### é è¨­è¨­å®š

- **é è¨­é »ç‡**: `"weekly"` (æ¯é€±èª¿å€‰)
- å¯åœ¨ç­–ç•¥çš„ `default_config` ä¸­ä¿®æ”¹
- å¯åœ¨å›æ¸¬æ™‚é€éåƒæ•¸è¦†å¯«

### ä½¿ç”¨ç¯„ä¾‹

```python
from Platform import Backtester

# æ¯é€±èª¿å€‰ (é è¨­)
result = Backtester.run(
    strategy=MyStrategy(),
    rebalance_freq="weekly",  # æ¯é€±äº”èª¿å€‰
)

# æ¯æ—¥èª¿å€‰
result = Backtester.run(
    strategy=MyStrategy(),
    rebalance_freq="daily",  # æ¯å€‹äº¤æ˜“æ—¥èª¿å€‰
)

# æ¯æœˆèª¿å€‰
result = Backtester.run(
    strategy=MyStrategy(),
    rebalance_freq="monthly",  # æ¯æœˆæœ€å¾Œä¸€å€‹äº¤æ˜“æ—¥èª¿å€‰
)
```

### å¯¦ä½œç´°ç¯€

èª¿å€‰æ—¥æœŸçš„æ±ºå®šé‚è¼¯åœ¨ `Backtest/engine.py` çš„ `_get_rebalance_dates()` æ–¹æ³•ï¼š

```python
def _get_rebalance_dates(dates: pd.DatetimeIndex, freq: str) -> set:
    """å–å¾—èª¿å€‰æ—¥æœŸ"""
    if freq == "daily":
        return set(dates)  # æ‰€æœ‰äº¤æ˜“æ—¥
    elif freq == "weekly":
        # æ¯é€±äº”èª¿å€‰
        return set(dates[dates.dayofweek == 4])
    elif freq == "monthly":
        # æ¯æœˆæœ€å¾Œä¸€å€‹äº¤æ˜“æ—¥
        return set(dates.to_series().groupby(dates.to_period('M')).last())
    else:
        return set(dates)
```

---

## ğŸ”€ æ›è‚¡é‚è¼¯ (Stock Selection & Rebalancing)

### æ›è‚¡æµç¨‹

å›æ¸¬å¼•æ“çš„æ›è‚¡é‚è¼¯åˆ†ç‚ºä»¥ä¸‹æ­¥é©Ÿï¼š

#### 1. **è¨ˆç®—å› å­åˆ†æ•¸** (Strategy.compute)

ç­–ç•¥é€é `compute()` æ–¹æ³•è¨ˆç®—æ¯æª”è‚¡ç¥¨çš„å› å­åˆ†æ•¸ï¼š

```python
def compute(self, db):
    """è¨ˆç®—å› å­åˆ†æ•¸ï¼Œåˆ†æ•¸è¶Šé«˜è¡¨ç¤ºè¶Šçœ‹å¥½"""
    close = db.get('close')
    momentum = ts_pct_change(close, 20)
    return zscore(momentum)  # è¿”å›åˆ†æ•¸ DataFrame
```

- **è¼¸å…¥**: FieldDB è³‡æ–™åº«
- **è¼¸å‡º**: DataFrame (rows=æ—¥æœŸ, cols=è‚¡ç¥¨ä»£ç¢¼, values=åˆ†æ•¸)
- **åˆ†æ•¸æ„ç¾©**: åˆ†æ•¸è¶Šé«˜ï¼Œè¡¨ç¤ºè©²è‚¡ç¥¨è¶Šå€¼å¾—æŠ•è³‡

#### 2. **ç¯©é¸æŠ•è³‡ç¯„åœ** (Strategy.filter_universe)

å¯é¸çš„ç¯©é¸æ­¥é©Ÿï¼Œæ’é™¤ä¸ç¬¦åˆæ¢ä»¶çš„è‚¡ç¥¨ï¼š

```python
def filter_universe(self, db):
    """ç¯©é¸å¯æŠ•è³‡çš„è‚¡ç¥¨"""
    close = db.get('close')
    volume = db.get('volume')
    
    # ä¾‹å¦‚ï¼šæ’é™¤æˆäº¤é‡éä½çš„è‚¡ç¥¨
    daily_amount = close * volume
    return ts_mean(daily_amount, 20) > 5_000_000
```

- **é è¨­è¡Œç‚º**: æ‰€æœ‰æœ‰åƒ¹æ ¼è³‡æ–™çš„è‚¡ç¥¨éƒ½å¯æŠ•è³‡
- **è¿”å›**: å¸ƒæ— DataFrameï¼ŒTrue è¡¨ç¤ºå¯æŠ•è³‡

#### 3. **è¨ˆç®—æŠ•è³‡æ¬Šé‡** (Strategy.get_weights)

æ ¹æ“šåˆ†æ•¸æ±ºå®šæ¯æª”è‚¡ç¥¨çš„æŠ•è³‡æ¬Šé‡ï¼š

```python
def get_weights(self, score: pd.DataFrame) -> pd.DataFrame:
    """è¨ˆç®—æŠ•è³‡çµ„åˆæ¬Šé‡"""
    top_n = self.config.get('top_n', 10)  # é è¨­æŒæœ‰ 10 æª”
    max_weight = self.config.get('max_weight', 0.15)  # å–®æª”æœ€å¤§ 15%
    
    # å–åˆ†æ•¸æ’å
    ranks = score.rank(axis=1, ascending=False)
    
    # é¸å– top_n
    selected = ranks <= top_n
    
    # ç­‰æ¬Šé‡åˆ†é…
    weights = selected.astype(float)
    weights = weights.div(weights.sum(axis=1), axis=0)
    
    # é™åˆ¶æœ€å¤§æ¬Šé‡
    weights = weights.clip(upper=max_weight)
    weights = weights.div(weights.sum(axis=1), axis=0)
    
    return weights
```

**é è¨­é‚è¼¯**:
- é¸æ“‡åˆ†æ•¸æœ€é«˜çš„ **top_n** æª”è‚¡ç¥¨ (é è¨­ 10 æª”)
- **ç­‰æ¬Šé‡**åˆ†é…çµ¦é¸ä¸­çš„è‚¡ç¥¨
- é™åˆ¶å–®æª”æœ€å¤§æ¬Šé‡ (é è¨­ 15%)
- å¯è¦†å¯«æ­¤æ–¹æ³•å¯¦ä½œè‡ªè¨‚æ¬Šé‡é‚è¼¯

#### 4. **åŸ·è¡Œäº¤æ˜“** (Backtester._simulate)

åœ¨èª¿å€‰æ—¥ï¼Œæ¯”è¼ƒç•¶å‰æŒå€‰èˆ‡ç›®æ¨™æŒå€‰ï¼ŒåŸ·è¡Œè²·è³£ï¼š

```python
# æ˜¯å¦èª¿å€‰æ—¥
if date in rebalance_dates:
    # ç›®æ¨™æŒå€‰
    target_weights = weights.loc[date]
    target_value = target_weights * total_value
    target_shares = target_value / price
    
    # è¨ˆç®—äº¤æ˜“
    trade_shares = target_shares - holdings
    
    # åŸ·è¡Œè²·è³£
    for ticker in tickers:
        if trade_shares[ticker] > 0:
            # è²·å…¥
        elif trade_shares[ticker] < 0:
            # è³£å‡º
```

**æ›è‚¡è§¸ç™¼æ¢ä»¶**:
- âœ… ç•¶å‰æ˜¯èª¿å€‰æ—¥ (`date in rebalance_dates`)
- âœ… ç›®æ¨™æŒå€‰èˆ‡ç•¶å‰æŒå€‰ä¸åŒ (`trade_shares != 0`)

**äº¤æ˜“è¦å‰‡**:
- **è²·å…¥**: `target_shares > holdings` â†’ è²·å…¥å·®é¡
- **è³£å‡º**: `target_shares < holdings` â†’ è³£å‡ºå·®é¡
- **æŒæœ‰**: `target_shares == holdings` â†’ ä¸äº¤æ˜“

---

## ğŸ“‹ å®Œæ•´å›æ¸¬æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. è¼‰å…¥è³‡æ–™åº« (FieldDB)                                     â”‚
â”‚     - åƒ¹æ ¼è³‡æ–™ (close)                                      â”‚
â”‚     - å…¶ä»–å› å­è³‡æ–™                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. åŸ·è¡Œç­–ç•¥è¨ˆç®— (Strategy.run)                             â”‚
â”‚     â”œâ”€ compute() â†’ è¨ˆç®—å› å­åˆ†æ•¸                             â”‚
â”‚     â”œâ”€ filter_universe() â†’ ç¯©é¸æŠ•è³‡ç¯„åœ                     â”‚
â”‚     â””â”€ get_weights() â†’ è¨ˆç®—æŠ•è³‡æ¬Šé‡                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. æ±ºå®šèª¿å€‰æ—¥æœŸ                                            â”‚
â”‚     - daily: æ‰€æœ‰äº¤æ˜“æ—¥                                     â”‚
â”‚     - weekly: æ¯é€±äº”                                        â”‚
â”‚     - monthly: æ¯æœˆæœ€å¾Œä¸€å€‹äº¤æ˜“æ—¥                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. æ¨¡æ“¬äº¤æ˜“ (é€æ—¥)                                         â”‚
â”‚     â”œâ”€ éèª¿å€‰æ—¥: åƒ…æ›´æ–°æŒå€‰åƒ¹å€¼                             â”‚
â”‚     â””â”€ èª¿å€‰æ—¥:                                              â”‚
â”‚         â”œâ”€ æ¯”è¼ƒç›®æ¨™æŒå€‰ vs ç•¶å‰æŒå€‰                         â”‚
â”‚         â”œâ”€ è¨ˆç®—éœ€è¦è²·è³£çš„è‚¡ç¥¨                               â”‚
â”‚         â”œâ”€ åŸ·è¡Œè²·å…¥ (æ‰£é™¤æ‰‹çºŒè²»ã€æ»‘åƒ¹)                      â”‚
â”‚         â”œâ”€ åŸ·è¡Œè³£å‡º (æ‰£é™¤æ‰‹çºŒè²»ã€è­‰äº¤ç¨…ã€æ»‘åƒ¹)              â”‚
â”‚         â””â”€ æ›´æ–°æŒå€‰                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. è¨ˆç®—ç¸¾æ•ˆæŒ‡æ¨™                                            â”‚
â”‚     - ç¸½å ±é…¬ç‡ã€å¹´åŒ–å ±é…¬ç‡                                  â”‚
â”‚     - å¤æ™®æ¯”ç‡ã€æœ€å¤§å›æ’¤                                     â”‚
â”‚     - äº¤æ˜“æ¬¡æ•¸ã€é€±è½‰ç‡                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ æ›è‚¡ç¯„ä¾‹

### ç¯„ä¾‹ 1: æ¯é€±èª¿å€‰

å‡è¨­ç­–ç•¥è¨­å®šï¼š
- `rebalance_freq="weekly"` (æ¯é€±äº”èª¿å€‰)
- `top_n=10` (æŒæœ‰ 10 æª”è‚¡ç¥¨)

**æ™‚é–“è»¸**:
- **é€±ä¸€**: ä¸èª¿å€‰ï¼Œåƒ…æ›´æ–°æŒå€‰åƒ¹å€¼
- **é€±äºŒ**: ä¸èª¿å€‰ï¼Œåƒ…æ›´æ–°æŒå€‰åƒ¹å€¼
- **é€±ä¸‰**: ä¸èª¿å€‰ï¼Œåƒ…æ›´æ–°æŒå€‰åƒ¹å€¼
- **é€±å››**: ä¸èª¿å€‰ï¼Œåƒ…æ›´æ–°æŒå€‰åƒ¹å€¼
- **é€±äº”**: âœ… **èª¿å€‰æ—¥**
  - è¨ˆç®—æœ€æ–°å› å­åˆ†æ•¸
  - é¸å‡ºåˆ†æ•¸æœ€é«˜çš„ 10 æª”è‚¡ç¥¨
  - æ¯”è¼ƒèˆ‡ç•¶å‰æŒå€‰çš„å·®ç•°
  - è³£å‡ºä¸åœ¨æ–°åå–®çš„è‚¡ç¥¨
  - è²·å…¥æ–°åå–®ä¸­çš„è‚¡ç¥¨
  - èª¿æ•´ç¾æœ‰æŒå€‰çš„æ¬Šé‡

### ç¯„ä¾‹ 2: æ›è‚¡è§¸ç™¼

**ç•¶å‰æŒå€‰** (é€±äº”èª¿å€‰å‰):
- 2330 (å°ç©é›»): 15%
- 2317 (é´»æµ·): 12%
- 2454 (è¯ç™¼ç§‘): 10%
- ... (å…± 10 æª”)

**æ–°åˆ†æ•¸æ’å** (é€±äº”èª¿å€‰æ™‚):
1. 2330 (å°ç©é›»): åˆ†æ•¸ 2.5
2. 2454 (è¯ç™¼ç§‘): åˆ†æ•¸ 2.1
3. 2308 (å°é”é›»): åˆ†æ•¸ 1.8 â† **æ–°é€²**
4. 2317 (é´»æµ·): åˆ†æ•¸ 1.5
5. ... (å…± 10 æª”)

**æ›è‚¡å‹•ä½œ**:
- âœ… **ä¿ç•™**: 2330, 2454, 2317 (ä»åœ¨ top 10)
- âŒ **è³£å‡º**: ä¸åœ¨æ–° top 10 çš„è‚¡ç¥¨
- âœ… **è²·å…¥**: 2308 (æ–°é€² top 10)
- ğŸ”„ **èª¿æ•´æ¬Šé‡**: é‡æ–°ç­‰æ¬Šé‡åˆ†é… (æ¯æª”ç´„ 10%)

---

## âš™ï¸ ç­–ç•¥åƒæ•¸è¨­å®š

### é è¨­åƒæ•¸

åœ¨ `Strategies/base.py` çš„ `default_config`:

```python
default_config = {
    "rebalance_freq": "weekly",      # èª¿å€‰é »ç‡
    "top_n": 10,                      # æŒæœ‰è‚¡ç¥¨æ•¸
    "max_weight": 0.15,               # å–®æª”æœ€å¤§æ¬Šé‡
    "transaction_cost": 0.001425,     # æ‰‹çºŒè²»ç‡ (0.1425%)
    "tax": 0.003,                     # è­‰äº¤ç¨… (0.3%, è³£å‡ºæ™‚)
    "slippage": 0.001,                # æ»‘åƒ¹ (0.1%)
}
```

### è‡ªè¨‚åƒæ•¸

å¯åœ¨ç­–ç•¥é¡åˆ¥ä¸­è¦†å¯«ï¼š

```python
class MyStrategy(Strategy):
    default_config = {
        "rebalance_freq": "monthly",  # æ”¹ç‚ºæ¯æœˆèª¿å€‰
        "top_n": 15,                   # æŒæœ‰ 15 æª”
        "max_weight": 0.20,            # å–®æª”æœ€å¤§ 20%
    }
```

æˆ–åœ¨å›æ¸¬æ™‚è¦†å¯«ï¼š

```python
result = Backtester.run(
    strategy=MyStrategy(),
    rebalance_freq="daily",  # è¦†å¯«ç‚ºæ¯æ—¥èª¿å€‰
)
```

---

## ğŸ“Š äº¤æ˜“æˆæœ¬

å›æ¸¬å¼•æ“æœƒè€ƒæ…®ä»¥ä¸‹äº¤æ˜“æˆæœ¬ï¼š

| æˆæœ¬é¡å‹ | è²»ç‡ | èªªæ˜ | é©ç”¨æ™‚æ©Ÿ |
|---------|------|------|---------|
| **æ‰‹çºŒè²»** | 0.1425% | è²·è³£éƒ½æ”¶å– | æ¯æ¬¡äº¤æ˜“ |
| **è­‰äº¤ç¨…** | 0.3% | åƒ…è³£å‡ºæ™‚æ”¶å– | è³£å‡ºæ™‚ |
| **æ»‘åƒ¹** | 0.1% | æ¨¡æ“¬å¯¦éš›æˆäº¤åƒ¹å·® | æ¯æ¬¡äº¤æ˜“ |

**è¨ˆç®—å…¬å¼**:
- **è²·å…¥æˆæœ¬**: `åƒ¹æ ¼ Ã— (1 + æ»‘åƒ¹) Ã— (1 + æ‰‹çºŒè²»ç‡)`
- **è³£å‡ºæ”¶å…¥**: `åƒ¹æ ¼ Ã— (1 - æ»‘åƒ¹) Ã— (1 - æ‰‹çºŒè²»ç‡ - è­‰äº¤ç¨…ç‡)`

---

## ğŸ” é—œéµç¨‹å¼ç¢¼ä½ç½®

| åŠŸèƒ½ | æª”æ¡ˆä½ç½® | é—œéµæ–¹æ³• |
|------|---------|---------|
| **èª¿å€‰é »ç‡** | `Backtest/engine.py` | `_get_rebalance_dates()` |
| **æ›è‚¡é‚è¼¯** | `Backtest/engine.py` | `_simulate()` |
| **æ¬Šé‡è¨ˆç®—** | `Strategies/base.py` | `get_weights()` |
| **å› å­è¨ˆç®—** | `Strategies/base.py` | `compute()` |
| **ç­–ç•¥åŸ·è¡Œ** | `Strategies/base.py` | `run()` |

---

## ğŸ“ ç¸½çµ

### èª¿å€‰é »ç‡
- âœ… **æ¯é€±èª¿å€‰** (é è¨­): æ¯é€±äº”åŸ·è¡Œä¸€æ¬¡
- âœ… **æ¯æ—¥èª¿å€‰**: æ¯å€‹äº¤æ˜“æ—¥éƒ½åŸ·è¡Œ
- âœ… **æ¯æœˆèª¿å€‰**: æ¯æœˆæœ€å¾Œä¸€å€‹äº¤æ˜“æ—¥åŸ·è¡Œ

### æ›è‚¡é‚è¼¯
1. **è¨ˆç®—åˆ†æ•¸**: ç­–ç•¥è¨ˆç®—æ¯æª”è‚¡ç¥¨çš„å› å­åˆ†æ•¸
2. **é¸è‚¡**: é¸æ“‡åˆ†æ•¸æœ€é«˜çš„ top_n æª”è‚¡ç¥¨
3. **æ¬Šé‡åˆ†é…**: ç­‰æ¬Šé‡åˆ†é… (å¯è‡ªè¨‚)
4. **åŸ·è¡Œäº¤æ˜“**: åœ¨èª¿å€‰æ—¥æ¯”è¼ƒç›®æ¨™èˆ‡ç•¶å‰æŒå€‰ï¼ŒåŸ·è¡Œè²·è³£

### æ›è‚¡è§¸ç™¼
- âœ… èª¿å€‰æ—¥ (`date in rebalance_dates`)
- âœ… ç›®æ¨™æŒå€‰èˆ‡ç•¶å‰æŒå€‰ä¸åŒ (`trade_shares != 0`)

---

**æœ€å¾Œæ›´æ–°**: 2026-02-08
